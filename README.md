# pool

## TODOs
1. posssibly refactor ix names to follow standard semantics
   1. Add -> Deposit
   2. RemoveX -> WithdrawX

## Developer Notes
- don't use `msg!()` in test-bpf tests. use `println!` and  `cargo test-bpf -- --show-output` 
- run `cargo fmt` to use `rustfmt`
  - configurations are in `rustfmt.toml`
### Running Tests
```bash
$ cd swim/pool
# run all tests
$ cargo test-bpf -- --show-output
# run specific test
$ cargo test-bpf -- --test test_pool_init --show-output
```

# Fuzzing
- workaround for honggfuzz macos x incompatability found [here](https://github.com/ilmoi/rebuild-token-vesting)
  - TLDR: use docker
How to run fuzz tests on mac os x in docker container
```sh
# 1. build docker container (only have to do this one time)
$ docker build -t pool .
# 2. run docker container
$ docker run -it -v $(pwd):/app/ pool bash
# should be in the docker container now
$ cd fuzz
$ BPF_OUT_DIR="/app/target/deploy" HFUZZ_RUN_ARGS="-t 10 -n 1 -N 100 -Q -d -v -l ./fuzz.log -R ./fuzz_report.log " cargo hfuzz run pool_fuzz > test_output.txt 2>&1
# -t = timeout in seconds
# -n = number of threads
# -N = number of iterations

``` 

if you run into an error on the last step with something like this:
"fatal error: ld terminated with signal 9"
you need to go to Docker Desktop and increase the memory and swap then retry again


### Personal notes
rebuild-token-vesting
- uses solana_program_test
- random tx generated by arbitrary/fuzz gets translated to all pre-requesite ixs needed
  - e.g. create gets translated to init + create

spl-token-swap
- doesn't use solana_program_test in fuzzing 